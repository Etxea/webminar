{% extends "site_base.html" %}

{% load i18n %}
{% load staticfiles %}

{% block head_title %}{% trans "Ver Webminar" %}{% endblock %}

{% block extra_head %}

  <link href='{% static "video-js/video-js.css"%}' rel="stylesheet" type="text/css">
  <!-- video.js must be in the <head> for older IEs to work. -->
  <script src='{% static "video-js/video.js" %}'></script>
  <script src='{% static "video-js/videojs.hls.js" %}'></script>
  <script src='{% static "video-js/videojs-media-sources.js" %}'></script>
  <!-- Unless using the CDN hosted version, update the URL to the Flash SWF -->
<!--
  <script>
    videojs.options.flash.swf = '{% static "video-js/video-js.swf" %}';
  </script>
-->
 

{% endblock %}

{% block extra_script %}


<script>
    
    function cargar_mensajes(email) {
        console.log("Vamos a cargar los mensajes generales y para "+email);
        $("#mensajes_list").load("/webminar/{{ webminar.id }}/mensaje/leer/"+email+"/");
        autoscroll = $("#checkbox_autoscroll").is(':checked');
        if (autoscroll) {
            console.log("El susuario quiere autoscroll");
            $("#mensajes_list").scrollTop($("#mensajes_list_interno").height()+20);
            
        }
    }
    
    function enviar_mensaje() {
        mensaje = $("#mensaje_input").val();
        //alert("Vamos a enviar mensaje: "+mensaje);
        data = {"webminar": {{webminar.id}}, "de": "{{email}}", "para": "admin@admin.es","texto": mensaje};
        //alert(data);
        
        $.ajax({
            type: "POST",
            url: "/webminar/{{ webminar.id }}/mensaje/enviar/",
            data: data,
            success: mensaje_enviado(data,status)
            //error: mensaje_fallado(status,error),
        });
        
    }
    function mensaje_fallado(status,error) {
        console.log("Error enviando el mensaje");
        console.log(status);
        console.log(error);
    }
    function mensaje_enviado(data,status) {
        //FIXME
        //alert(data["recibido"]);
        //if data["recibido"] {};
        console.log("Mensaje enviado");
        console.log(status);
        console.log(data);
        $("#mensaje_input").val('');
        cargar_mensajes("{{email}}")
    }
    
    $(function(){
        console.log("Ponemos el intervalo");
        
        var intervalID = setInterval(function(){
            cargar_mensajes("{{email}}");
            }, 5000);
        console.log("Intervalo "+intervalID+" creado");
        
        $('#mensaje_input').keypress(function(e) {
            // Enter pressed?
            
            if(e.which == 10 || e.which == 13) {
                console.log("Mandamos el mensaje");
                enviar_mensaje();
            }
        });
        
        // display information about the video type
		
    });
    
		});
</script>
{% endblock %}


{% block body %}

<!--
<div class="row">
<div class="col-md-12">
	<div class="flowplayer is-splash"
     data-qualities="288p,480p,576p"
     data-default-quality="480p"
     data-rtmp="rtmp://webminar.beovipel.es/hls/emision"
     data-ratio="0.75">
 
   <video poster="">
      <source type="application/x-mpegurl" src="http://webminar.beovipel.es:8080/hls/emision.m3u8">
     
   </video>
 
</div>
 
<p>Video type: <span id="vtype"></span></p>
</div>
</div>

-->

<div class="row">
    <div class="col-md-9">
        <video id="webminar_video" class="video-js vjs-default-skin" 
			controls preload="none" width="800" height="450" autoplay data-setup="{}">

<!--
            <source src="rtmp://178.32.12.60/emision/prueba" type='rtmp/mp4' >    
-->

            <source src="http://webminar.beovipel.es:8080/hls/emision.m3u8" type="application/x-mpegURL">

        </video>
        <h3>Detalles</h3>
        <ul>
            <li>{{webminar.titulo}}</li>
            <li>{{webminar.descripcion}}</li>
            <li>Desde {{webminar.inicio}} hasta {{webminar.fin}}</li>
        </ul>
    </div>
    <div class="col-md-3">
        <h3>Preguntas</h3>
    
        <!-- <button id="enviar_mensaje" onclick="enviar_mensaje();">Enviar</button> -->
	
        <div id="mensajes_list" style="overflow-y: scroll; height: 370px" >
        Cargando...
        </div>
        <input id="mensaje_input"  class="form-control" placeholder="Escriba su pregunta(max 250 caracteres)" maxlength="250"></input>
        <div class="checkbox">
                <label><input type="checkbox" id="checkbox_autoscroll"> Autoscroll</label>
        </div>
    </div>

</div>

<div class="row">
    <div class="col-md-12">
    
    </div>
</div>

{% endblock %}
