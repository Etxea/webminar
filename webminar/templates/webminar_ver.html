{% extends "site_base.html" %}

{% load i18n %}

{% block head_title %}{% trans "Ver Webminar" %}{% endblock %}

{% block extra_head %}
<link href="//vjs.zencdn.net/4.8/video-js.css" rel="stylesheet">
{% endblock %}

{% block extra_script %}
<script src="//vjs.zencdn.net/4.8/video.js"></script>
<script>
    
    function cargar_mensajes(email) {
        console.log("Vamos a cargar los mensajes generales y para "+email);
        $("#mensajes_list").load("/webminar/{{ webminar.id }}/mensaje/leer/"+email+"/");
    }
    
    function enviar_mensaje() {
        mensaje = $("#mensaje_input").val();
        //alert("Vamos a enviar mensaje: "+mensaje);
        data = {"webminar": {{webminar.id}}, "de": "{{email}}", "para": "admin@admin.es","texto": mensaje};
        //alert(data);
        
        $.ajax({
            type: "POST",
            url: "/webminar/{{ webminar.id }}/mensaje/enviar/",
            data: data,
            success: mensaje_enviado(data,status)
            //error: mensaje_fallado(status,error),
        });
        
    }
    function mensaje_fallado(status,error) {
        console.log("Error enviando el mensaje");
        console.log(status);
        console.log(error);
    }
    function mensaje_enviado(data,status) {
        //FIXME
        //alert(data["recibido"]);
        //if data["recibido"] {};
        console.log("Mensaje enviado");
        console.log(status);
        console.log(data);
        $("#mensaje_input").val('');
        cargar_mensajes("{{email}}")
    }
    
    $(function(){
        console.log("Ponemos el intervalo");
        
        var intervalID = setInterval(function(){$("#mensajes_list").load("/webminar/{{ webminar.id }}/mensaje/leer/{{email}}/");}, 5000);
        console.log("Intervalo "+intervalID+" creado");
    });
    
</script>
{% endblock %}


{% block body %}




<div class="row">
    <div class="col-md-9">
        <video width="800" height="540" autoplay class="video-js vjs-default-skin" id="video_stream" >
            <source src="http://178.32.12.60:8080/vod/dejame_vivir.mp4" type="video/mp4" >
             <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
        </video>
        <h3>Detalles</h3>
        <ul>
            <li>{{webminar.slug}}</li>
            <li>{{webminar.inicio}}</li>
            <li>{{webminar.fin}}</li>
        </ul>
    </div>
    <div class="col-md-3">
        <h3>Preguntas</h3>
        
        <p>Enviar pregunta<input id="mensaje_input" ></input><button id="enviar_mensaje" onclick="enviar_mensaje();">Enviar</button></p>
        <div id="mensajes_list">
        Cargando...
        </div>
    </div>

</div>

<div class="row">
    <div class="col-md-12">
    
    </div>
</div>

{% endblock %}
